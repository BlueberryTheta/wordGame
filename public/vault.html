<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Inqaily — Vault</title>
    <script>
      (function(){ try { if (localStorage.getItem('theme') === 'light') document.documentElement.classList.add('theme-light'); } catch {} })();
    </script>
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/light.css" />
    <style>
      .vault{max-width:800px; margin:32px auto; padding:0 16px}
      .picker{background:var(--card); border:1px solid var(--shade); border-radius:12px; padding:16px; margin:16px 0}
      .done-list{background:var(--card); border:1px solid var(--shade); border-radius:12px; padding:16px; margin:16px 0}
      .done-list ul{margin:8px 0 0; padding-left:18px}
      .muted{color:var(--muted)}
    </style>
  </head>
  <body>
    <div class="vault">
      <div class="titlebar" style="margin-bottom:8px">
        <div class="title-main"><h1 style="margin:0">Vault</h1><div class="subtitle">Play previous days</div></div>
        <div class="title-actions">
          <button id="themeToggle" class="theme-toggle" title="Toggle theme" aria-label="Toggle theme">☀</button>
          <div class="menu-mount">
            <button id="menuToggle" class="menu-toggle" aria-label="Menu" aria-expanded="false" aria-haspopup="true" aria-controls="menuDropdown" title="Menu">☰</button>
            <div id="menuDropdown" class="menu-dropdown hidden" role="menu" aria-hidden="true">
              <a href="/" role="menuitem">Daily</a>
              <a href="/puzzle.html" role="menuitem">Puzzle</a>
            </div>
          </div>
        </div>
      </div>

      <section class="picker">
        <h2>Select a Day</h2>
        <div id="cal" class="cal" aria-label="Calendar">
          <div class="cal-header">
            <button id="prevMon" class="cal-nav" aria-label="Previous month">‹</button>
            <div id="calTitle" class="cal-title">Month YYYY</div>
            <button id="nextMon" class="cal-nav" aria-label="Next month">›</button>
          </div>
          <div class="cal-grid cal-dow">
            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
          </div>
          <div id="calGrid" class="cal-grid" role="grid"></div>
        </div>
        <p class="muted" style="margin-top:8px">Click a past day to play that day’s original game. Completed days are marked.</p>
      </section>

      <section class="done-list">
        <h2>Completed Days</h2>
        <div id="doneWrap" class="muted">No days completed yet.</div>
      </section>

      <footer>
        <small>New word rolls at 12:01 AM Eastern Time.</small>
        <nav class="legal-links" aria-label="Legal and Privacy">
          <a href="/privacy.html">Privacy</a>
          <span class="sep">•</span>
          <a href="/terms.html">Terms</a>
          <span class="sep">•</span>
          <a href="/cookies.html">Cookies</a>
        </nav>
      </footer>
    </div>

    <script>
      // Theme quick setup
      function applyTheme(theme){ const r=document.documentElement; if(theme==='light') r.classList.add('theme-light'); else r.classList.remove('theme-light'); try{ localStorage.setItem('theme',theme);}catch{}; const t=document.getElementById('themeToggle'); if(t){ t.textContent = theme==='light'?'\u263E':'\u2600'; t.setAttribute('aria-label', theme==='light'?'Switch to dark mode':'Switch to light mode'); } }
      (function(){ let theme='dark'; try{ theme=localStorage.getItem('theme')||theme;}catch{} applyTheme(theme); const t=document.getElementById('themeToggle'); t?.addEventListener('click',()=>{ const next=(localStorage.getItem('theme')||'dark')==='light'?'dark':'light'; applyTheme(next); }); })();
      // Menu
      (function(){ const btn=document.getElementById('menuToggle'); const dd=document.getElementById('menuDropdown'); if(!btn||!dd) return; function close(){ dd.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); dd.setAttribute('aria-hidden','true'); document.removeEventListener('click', onDoc); document.removeEventListener('keydown', onEsc);} function onDoc(e){ if(e.target===btn||btn.contains(e.target)||e.target===dd||dd.contains(e.target)) return; close(); } function onEsc(e){ if(e.key==='Escape') close(); } btn.addEventListener('click',(e)=>{ e.stopPropagation(); const hidden=dd.classList.contains('hidden'); if(hidden){ dd.classList.remove('hidden'); btn.setAttribute('aria-expanded','true'); dd.setAttribute('aria-hidden','false'); setTimeout(()=>{ document.addEventListener('click', onDoc); document.addEventListener('keydown', onEsc); },0);} else close(); }); })();
      // Calendar render + navigation
      (function(){
        const tz = 'America/New_York';
        function etParts(d){ const fY=new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric'}); const fM=new Intl.DateTimeFormat('en-CA',{timeZone:tz,month:'2-digit'}); const fD=new Intl.DateTimeFormat('en-CA',{timeZone:tz,day:'2-digit'}); return { y:parseInt(fY.format(d),10), m:parseInt(fM.format(d),10), d:parseInt(fD.format(d),10) }; }
        function dayKeyFromYMD(y,m,d){ return `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`; }
        function endOfMonth(y,m){ return new Date(Date.UTC(y, m-1+1, 0)); }
        const today = new Date(); const tP = etParts(today); const todayKey = dayKeyFromYMD(tP.y, tP.m, tP.d);
        // Earliest selectable day (inclusive)
        const MIN_Y = 2025, MIN_M = 9; const MIN_D = 27;
        const minKey = dayKeyFromYMD(MIN_Y, MIN_M, MIN_D);
        let viewY = tP.y, viewM = tP.m;
        const title = document.getElementById('calTitle'); const grid = document.getElementById('calGrid');
        const prev = document.getElementById('prevMon'); const next = document.getElementById('nextMon');
        // Completed set from localStorage
        function getCompleted(){ const set=new Set(); try{ for(let i=0;i<localStorage.length;i++){ const k=localStorage.key(i)||''; if(k.startsWith('wotd:')){ try{ const v=JSON.parse(localStorage.getItem(k)||'{}'); if(v && (v.gameOver || v.guessesLeft===0)) set.add(k.slice(5)); }catch{} } } } catch{} return set; }
        function render(){
          const completed = getCompleted();
          const first = new Date(Date.UTC(viewY, viewM-1, 1));
          const startDow = first.getUTCDay(); // use UTC; minor drift acceptable for calendar layout
          const eom = endOfMonth(viewY, viewM);
          const daysInMonth = eom.getUTCDate();
          const monthName = new Intl.DateTimeFormat('en-US',{ month:'long'}).format(new Date(viewY,viewM-1,1));
          title.textContent = `${monthName} ${viewY}`;
          grid.innerHTML = '';
          for (let i=0;i<startDow;i++){ const pad=document.createElement('div'); pad.className='cal-pad'; grid.appendChild(pad); }
          for (let d=1; d<=daysInMonth; d++){
            const key = dayKeyFromYMD(viewY, viewM, d);
            const cell = document.createElement('button'); cell.type='button'; cell.className='cal-cell'; cell.setAttribute('role','gridcell'); cell.textContent = String(d);
            if (key > todayKey || key < minKey){ cell.disabled = true; cell.classList.add('disabled'); }
            if (completed.has(key)){ const badge=document.createElement('span'); badge.className='cal-done'; badge.textContent='✓'; cell.appendChild(badge); }
            cell.onclick = ()=>{ if (!cell.disabled) location.href='/?day='+encodeURIComponent(key); };
            grid.appendChild(cell);
          }
        }
        prev.onclick = ()=>{ const atMinMonth = (viewY===MIN_Y && viewM===MIN_M); if (atMinMonth) return; if (viewM===1){ viewM=12; viewY--; } else viewM--; if (viewY < MIN_Y || (viewY===MIN_Y && viewM<MIN_M)) { viewY=MIN_Y; viewM=MIN_M; } render(); };
        next.onclick = ()=>{ if (viewY>tP.y || (viewY===tP.y && viewM>=tP.m)) return; if (viewM===12){ viewM=1; viewY++; } else viewM++; render(); };
        render();
      })();
      // Completed days list
      ;(function(){ const wrap=document.getElementById('doneWrap'); const out=[]; try{ for(let i=0;i<localStorage.length;i++){ const k=localStorage.key(i)||''; if(k.startsWith('wotd:')){ try{ const v=JSON.parse(localStorage.getItem(k)||'{}'); if(v && (v.gameOver || v.guessesLeft===0)) out.push(k.replace(/^wotd:/,'')); }catch{} } } } catch{} if(out.length){ out.sort(); const ul=document.createElement('ul'); out.forEach(d=>{ const li=document.createElement('li'); li.textContent = d; ul.appendChild(li); }); wrap.textContent=''; wrap.appendChild(ul); } })();
    </script>
  </body>
  </html>
